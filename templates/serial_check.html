{% extends "base_tmp.html" %}
{% block content %}
<div class="container mt-1">
    <h3>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä—ñ–π–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤</h3>
    <form method="POST" action="/scheck">
        <div class="mb-3">
            <label for="serials" class="form-label">–í—Å—Ç–∞–≤—Ç–µ —Å–ø–∏—Å–æ–∫ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä—è–¥–æ–∫):</label>
            <textarea class="form-control"
              id="serials"
              name="serials"
              rows="10"
              placeholder="–°–µ—Ä—ñ–π–Ω—ñ –Ω–æ–º–µ—Ä–∏ - –æ–¥–∏–Ω –Ω–∞ —Ä—è–¥–æ–∫">{% if raw_data %}{{ raw_data }}{% endif %}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</button>
    </form>
    <br>
    <div>
            <p class="text-primary fw-bold">–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: {{ total }}</p>
            <p class="fw-bold {{ 'text-danger' if total_err|int > 0 }}">–ü–æ–º–∏–ª–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤: {{ total_err }}</p>
    </div>


<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}?v={{ app_version }}">

<table class="table table-sm table-compact" id="resultsTable">
    <thead>
        <tr>
            <th>
                –°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyColumn(0)">üìã</button>
            </th>
            <th>
                –°—Ç–∞—Ç—É—Å –ë–î
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyColumn(1)">üìã</button>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for row in results %}
            <tr class="{{ 'table-danger' if '–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ' in row.status else 'table-success' }}">
                <td>{{ row.sn }}</td>
                <td>{{ row.status }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
</div>


<script src="{{ url_for('static', filename='js/tables.js') }}"></script>
    <script>
        $(document).ready(function() {
            initDefaultDataTable('#tList', {
                "pageLength": 25 // –ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            });
        });
    </script>

<script>
function copyColumn(colIndex) {
    const table = document.getElementById('resultsTable');
    let rows = table.querySelectorAll('tbody tr');

    // –ó–±–∏—Ä–∞—î–º–æ —Ç–µ–∫—Å—Ç —ñ–∑ –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è
    let textToCopy = Array.from(rows)
        .map(row => {
            const cell = row.cells[colIndex];
            return cell ? cell.innerText.trim() : '';
        })
        .filter(text => text !== '') // —ñ–≥–Ω–æ—Ä—É—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
        .join('\n');

    if (!textToCopy) {
        alert('–ù—ñ—á–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏!');
        return;
    }

    // –†–µ–∑–µ—Ä–≤–Ω–∏–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
    const textArea = document.createElement("textarea");
    textArea.value = textToCopy;

    // –†–æ–±–∏–º–æ –π–æ–≥–æ –Ω–µ–≤–∏–¥–∏–º–∏–º
    textArea.style.position = "fixed";
    textArea.style.left = "-9999px";
    textArea.style.top = "0";
    document.body.appendChild(textArea);

    textArea.focus();
    textArea.select();

    try {
        const successful = document.execCommand('copy');
        if (successful) {
            alert('–°—Ç–æ–≤–ø—á–∏–∫ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ —É –±—É—Ñ–µ—Ä!');
        } else {
            console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏');
        }
    } catch (err) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—ñ:', err);
    }

    document.body.removeChild(textArea);
}
</script>

{% endblock %}