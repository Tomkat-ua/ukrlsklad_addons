{% extends "base_tmp.html" %}
{% block content %}
<head>
    <style>
        /* –ó–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫–∞ */
    .table-hover tbody tr:hover {
        background-color: #fff9db !important; /* –ù—ñ–∂–Ω–æ-–±–ª–∞–∫–∏—Ç–Ω–∏–π */
        transition: background-color 0.2s ease; /* –ü–ª–∞–≤–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ */
    }
<!--    table.table-striped tbody tr:nth-of-type(odd):hover td {-->
<!--        background-color: #fff9db !important;-->
<!--    }-->
    </style>
</head>
<!--&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
{#
<div class="container mt-1">
    <h3>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä—ñ–π–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤</h3>
    <form method="POST" action="/scheck">
        <div class="mb-3">
            <label for="serials" class="form-label">–í—Å—Ç–∞–≤—Ç–µ —Å–ø–∏—Å–æ–∫ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä—è–¥–æ–∫):</label>
            <textarea class="form-control"
              id="serials0"
              name="serials"
              rows="10"
              placeholder="–°–µ—Ä—ñ–π–Ω—ñ –Ω–æ–º–µ—Ä–∏ - –æ–¥–∏–Ω –Ω–∞ —Ä—è–¥–æ–∫">{% if raw_data %}{{ raw_data }}{% endif %}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</button>
    </form>
    <br>
    <table class="table table-sm table-hover table-bordered table-compact">
        <thead>
        <tr>
            <th>TOVAR_ID</th>
            <th>TOVAR KOD</th>
            <th>NAME</th>
            <th>COUNT</th>
        </tr>
        </thead>
        {% for row in data_g %}
        <tr>
            <td>{{ row.TOVAR_ID }}</td>
            <td>{{ row.KOD }}</td>
            <td>{{ row.NAME }}</td>
            <td>{{ row.COUNT_ }}</td>
        </tr>
        {% endfor %}
    </table>

    <div>
            <h6 class="text-primary fw-bold">–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: {{ total }}</h6>
            <h6 class="fw-bold {{ 'text-danger' if total_err|int > 0 }}">–ü–æ–º–∏–ª–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤: {{ total_err }}</h6>
    </div> #}
<!--    -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--&#45;&#45;-->
<div class="container-fluid mt-2"> <h3>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä—ñ–π–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤</h3>

    <div class="row">
        <div class="col-md-4">
            <form method="POST" action="/scheck" class="card p-3 shadow-sm">
                <div class="mb-3">
                    <label for="serials" class="form-label fw-bold">–í—Å—Ç–∞–≤—Ç–µ —Å–ø–∏—Å–æ–∫:</label>
                    <textarea class="form-control"
                      id="serials"
                      name="serials"
                      rows="15"
                      style="font-family: monospace; font-size: 0.85rem;"
                      placeholder="–û–¥–∏–Ω –Ω–æ–º–µ—Ä –Ω–∞ —Ä—è–¥–æ–∫">{% if raw_data %}{{ raw_data }}{% endif %}</textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</button>
            </form>
        </div>

        <div class="col-md-8">
            <div class="card p-3 shadow-sm" style="height: 440px;">
                <label for="group1" class="form-label fw-bold">–ó–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å:</label>
                <div class="table-responsive">
                    <table id="group1" class="table table-sm table-hover table-bordered table-compact">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>TOVAR ID</th>
                                <th>TOVAR KOD</th>
                                <th>NAME</th>
                                <th class="text-center">COUNT</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data_g %}
                            <tr>
                                <td class="text-muted">{{ loop.index }}</td>
                                <td><code>{{ row.TOVAR_ID }}</code></td>
                                <td><kbd>{{ row.KOD }}</kbd></td>
                                <td>{{ row.NAME }}</td>
                                <td class="text-center fw-bold">{{ row.COUNT_ }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="mt-3">
                        <h6 class="text-primary fw-bold">–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: {{ total }}</h6>
                        <h6 class="fw-bold {{ 'text-danger' if total_err|int > 0 }}">–ü–æ–º–∏–ª–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤: {{ total_err }}</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--    &#45;&#45;-->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}?v={{ app_version }}">

<table class="table table-sm table-compact" id="resultsTable">
    <thead>
        <tr>
            <th>
                –°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyColumn(0)">üìã</button>
            </th>
            <th>
                –°—Ç–∞—Ç—É—Å –ë–î
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyColumn(1)">üìã</button>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for row in results %}
            <tr class="{{ 'table-danger' if '–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ' in row.status else 'table-success' }}">
                <td>{{ row.sn }}</td>
                <td>{{ row.status }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
</div>


<script src="{{ url_for('static', filename='js/tables.js') }}"></script>
    <script>
        $(document).ready(function() {
            initDefaultDataTable('#tList', {
                "pageLength": 25 // –ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            });
        });
    </script>

<script>
function copyColumn(colIndex) {
    const table = document.getElementById('resultsTable');
    let rows = table.querySelectorAll('tbody tr');

    // –ó–±–∏—Ä–∞—î–º–æ —Ç–µ–∫—Å—Ç —ñ–∑ –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è
    let textToCopy = Array.from(rows)
        .map(row => {
            const cell = row.cells[colIndex];
            return cell ? cell.innerText.trim() : '';
        })
        .filter(text => text !== '') // —ñ–≥–Ω–æ—Ä—É—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
        .join('\n');

    if (!textToCopy) {
        alert('–ù—ñ—á–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏!');
        return;
    }

    // –†–µ–∑–µ—Ä–≤–Ω–∏–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
    const textArea = document.createElement("textarea");
    textArea.value = textToCopy;

    // –†–æ–±–∏–º–æ –π–æ–≥–æ –Ω–µ–≤–∏–¥–∏–º–∏–º
    textArea.style.position = "fixed";
    textArea.style.left = "-9999px";
    textArea.style.top = "0";
    document.body.appendChild(textArea);

    textArea.focus();
    textArea.select();

    try {
        const successful = document.execCommand('copy');
        if (successful) {
            alert('–°—Ç–æ–≤–ø—á–∏–∫ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ —É –±—É—Ñ–µ—Ä!');
        } else {
            console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏');
        }
    } catch (err) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—ñ:', err);
    }

    document.body.removeChild(textArea);
}
</script>

{% endblock %}