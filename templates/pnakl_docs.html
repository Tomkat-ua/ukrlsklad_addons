{% extends "base_tmp.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}?v={{ app_version }}">

<div class="d-flex flex-column gap-2 mb-2 p-3 bg-light border rounded">
    <h5 class="mb-0">{{ title }}</h5>
        <h6 class="mb-0 text-muted">–ü–∞–ø–∫–∞ : {{ data_header.NU }}</h6>
        <h6 class="mb-0 text-muted">–î–∞—Ç–∞ –ø—Ä–∏—Ö–æ–¥—É : {{ data_header.DATE_DOK.strftime('%d.%m.%Y') if data_header.DATE_DOK }}</h6>
        <h6 class="mb-0 text-muted">–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ : {{ data_header.CLIENT }}</h6>
        <h6 class="mb-0 text-muted">–ü—ñ–¥—Å—Ç–∞–≤–∞: –∑–≥—ñ–¥–Ω–æ {{ data_header.DOC_TYPE }} ‚Ññ {{ data_header.CL_NU }} –≤—ñ–¥
                        {{ data_header.CL_DATE_DOK.strftime('%d.%m.%Y')
                            if data_header.CL_DATE_DOK and data_header.CL_DATE_DOK.year > 1
                            else '–±/–¥'}}
        </h6>
      {#  <h6 class="mb-0 text-muted">
            –î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ :
            {{ data_header.CL_DATE_DOK.strftime('%d.%m.%Y')
            if data_header.CL_DATE_DOK and data_header.CL_DATE_DOK.year > 1
            else '–±/–¥'}}
        </h6> #}
</div>

<div class="d-flex flex-wrap align-items-center gap-2 mb-2 p-2 bg-light border rounded">
    <table>
        {% for row in data_details %}
        <tr>
           <td>
               {{ row }}
           </td>
        </tr>
        {% endfor %}
    </table>
</div>

<div class="d-flex flex-wrap align-items-center gap-2 mb-2 p-2 bg-light border rounded">
        <div class="btn-group">
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleTree(true)">
                <i class="bi bi-plus-square"></i> –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleTree(false)">
                <i class="bi bi-dash-square"></i> –ó–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ
            </button>
        </div>
        <span class="text-muted small ms-2">–û–±–µ—Ä—ñ—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</span>
</div>

    {% macro render_node(nodes) %}
        <ul>
            {% for node in nodes %}
                <li>
                    {% if node.children %}
                        <details>
                            <summary>üìÅ {{ node.NAME }} </summary>
                            {{ render_node(node.children) }}
                        </details>
                    {% else %}
                        <div class="leaf">
                          <a href="/docs/{{ node.BLOB_ID | int }}/{{ doc_id }}/{{ node.TOVAR_ID | int }}?name={{ node.NAME }}">
                              üìÑ  {{ node.NAME }}
                              </a>
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endmacro %}
<div class="d-flex flex-wrap align-items-center gap-2 mb-2 p-2 bg-light border rounded">
    <div class="tree-container">
        {{ render_node(doc_tree) }}
    </div>
</div>


<table>

    {% for doc in doc_list %}
<tr>
    <td>
       {{ doc.NAME }}
    </td>
</tr>
{% endfor %}
</table>

<script src="{{ url_for('static', filename='js/tables.js') }}"></script>

<script>
function toggleTree(shouldOpen) {
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ details –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
    const allDetails = document.querySelectorAll('details');
    allDetails.forEach(el => {
        el.open = shouldOpen;
    });
}
</script>
{% endblock %}