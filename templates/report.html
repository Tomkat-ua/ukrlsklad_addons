{% extends "base_tmp.html" %}
{% block content %}

<body class="p-4 bg-light">
<div class="container">
    <h2 class="mb-4">{{ repname }}</h2>
    <button class="btn btn-sm btn-primary" onclick="copyTable()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é</button>
    <button class="btn btn-sm btn-primary" onclick="downloadTableAsCSV('{{ repname }}')">–ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ CSV</button>
    <button class="btn btn-sm btn-primary" onclick="downloadTableAsXLSX('{{ repname }}')">–ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ XLSX</button>
    <div class="table-responsive">
        <table id="tList" class="table table-main"
               data-default-length="50">
            <thead class="table-dark">
                <tr>
                    {% for col in columns %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr>
                        {% for cell in row %}
                            <td>{{ cell }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</body>



<script>

$(document).ready(function() {
    const tableElement = $('#tList');

    // 1. –ü–ï–†–ï–í–Ü–†–ö–ê: –ß–∏ —ñ—Å–Ω—É—î —Ç–∞–±–ª–∏—Ü—è
    if (!tableElement.length) {
        return;
    }
    // 2. –ü–ï–†–ï–í–Ü–†–ö–ê: –ß–∏ –≤–∂–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
    if ($.fn.DataTable.isDataTable('#tList')) {
        // –Ø–∫—â–æ —Ç–∞–±–ª–∏—Ü—è –≤–∂–µ —î DataTables, –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ
        return;
    }
    const defaultPageLengthString = tableElement.data('defaultLength');

    // 3. –ü–ï–†–ï–¢–í–û–†–ï–ù–ù–Ø: parseInt + –Ω–∞–¥—ñ–π–Ω–∏–π fallback
    const parsedLength = parseInt(defaultPageLengthString);

    // finalPageLength –±—É–¥–µ —á–∏—Å–ª–æ–º > 0 –∞–±–æ 20
    const finalPageLength = (isNaN(parsedLength) || parsedLength <= 0) ? -1 : parsedLength;

    // 4. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
    tableElement.DataTable({
        pageLength: finalPageLength,
        // –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ -1 —Ç–∞–∫–æ–∂ —î –¥—ñ–π—Å–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º —É lengthMenu
        lengthMenu: [ [20, 30, 50, -1], [20, 30, 50, "–£—Å—ñ"] ],
         language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/uk.json"
        }
    });
});

</script>

{% endblock %}