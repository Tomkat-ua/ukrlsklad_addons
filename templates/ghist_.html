{% extends "base_tmp.html" %}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">{{ records }}{{ serch_result }}</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      </ul>
      <form class="d-flex gap-1 align-items-center mb-1" method="post">
        <input class="form-control form-control-sm" style="width: 250px;" type="search" placeholder="–ù–∞–∑–≤–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—É"  minlength="5" name = "tov_name" value="{{ tov_name }}">
        <strong> –ê–ë–û </strong>
        <input class="form-control form-control-sm" style="width: 250px;" type="search" placeholder="–°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä"   minlength="5" name = "tov_serial" value="{{ search_value }}">
        <button class="btn btn-primary btn-sm bi-search" type="submit" > –®—É–∫–∞—Ç–∏</button>
        <button type="button" class="btn btn-sm btn-primary" onclick="copyTable()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é</button>
      </form>
    </div>
  </div>
</nav>


<table id="tList" class="table table-sm table-striped table-bordered">
    <thead class="table-dark">
    <tr>
      <th>TOVAR_ID</th>
      <th>–°–µ—Ä—ñ–π–Ω–∏–π –ù–æ–º–µ—Ä</th>
      <th>–ö–æ–¥ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∏</th>
      <th>–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–î—ñ—ó</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOVAR_ID }}</td>
      <td class="fw-bold text-success" style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOVAR_SER_NUM }}</td>
      <td style="padding-top: 1px; padding-bottom: 1px;">{{ row.KOD }}</td>
      <td class="fw-bold text-primary" style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOV_NAME }}</td>
      <td style="padding-top: 1px; padding-bottom: 1px;">
<!--&#45;&#45; '–í—Ç—Ä–∞—á–µ–Ω–æ'-->
  {% set status_text = row.STATUS_CODE %}
    {% if status_text == 8 %}
        <form target="_blank" method="POST" action="{{ url_for('losses_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-danger text-white fs-6 px-2 py-2 shadow border-0" title=">> –¥–æ –í—Ç—Ä–∞—Ç–∏">
                {{ row.STATUS }} >>
            </button>
        </form>
<!--&#45;&#45; '–†–æ–∑–∫–æ–º–ø–ª–µ–∫—Ç'          -->
    {% elif status_text == 9 %}
        <form target="_blank" method="POST" action="{{ url_for('dispack_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-secondary text-white fs-6 px-2 py-2 shadow border-0" title=">> –¥–æ –†–æ–∑–∫–æ–º–ø–ª–µ–∫—Ç—É–≤–∞–Ω–Ω—è">
                {{ row.STATUS }} >>
            </button>
        </form>
<!--&#45;&#45; '–°–ø–∏—Å–∞–Ω–æ (–ø–æ –≤—Ç—Ä–∞—Ç—ñ)'          -->
    {% elif status_text == 10 %}
        <form target="_blank" method="POST" action="{{ url_for('snakl_list' ) }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-warning text-dark fs-6 px-2 py-2 shadow border-0" title=">> –¥–æ –°–ø–∏—Å–∞–Ω–Ω—è">
                {{ row.STATUS }} >>
            </button>
        </form>
<!--&#45;&#45;&#45;&#45; —Å–ø–∏—Å–∞–Ω–æ –ø–æ  –∞–∫—Ç –ø—É—Å–∫—É-->
    {% elif status_text == 5 %}
        <form target="_blank" method="POST" action="{{ url_for('snakl_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill btn-info text-dark fs-6 px-2 py-2 shadow border-0" title=">> –¥–æ –í—Ç—Ä–∞—Ç–∏">
                {{ row.STATUS }} >>
            </button>
        </form>
<!--&#45;&#45;'–ù–∞ –æ–±–ª—ñ–∫—É'-->
    {% else %}
        <span class="badge rounded-pill bg-success text-light fs-6 px-2 py-2 shadow">
            {{ row.STATUS }}
        </span>
    {% endif %}
</td>
      <td style="padding-top: 1px; padding-bottom: 1px;"><a href="{{ url_for('ghist_details', row_id=row.SERIAL_ID) }}"
                                                            class="btn btn-sm btn-light">–î–µ—Ç–∞–ª—ñ</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<script>
$(document).ready(function() {

    // !!! –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ü–µ–π –º–∞—Å–∏–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–æ—ó —Ç–∞–±–ª–∏—Ü—ñ !!!
    // –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —É –≤–∞—Å 4 –∫–æ–ª–æ–Ω–∫–∏ (0, 1, 2, 3), —ñ –æ—Å—Ç–∞–Ω–Ω—è (3) - —Ü–µ –∫–Ω–æ–ø–∫–∏
    var columnsToExclude = [0,1,2,3,5];

    // =========================================================
    // 1. –Ñ–î–ò–ù–ê –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø DATATABLES
    // =========================================================
    var table = $('#tList').DataTable({
        "responsive": true,
        "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.7/i18n/uk.json"
        },
        // –í–∞–∂–ª–∏–≤–æ: –≤—ñ–¥–∫–ª—é—á–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–æ—à—É–∫, —è–∫—â–æ –≤—ñ–Ω –∑–∞–≤–∞–∂–∞—î
        "searching": true
    });

    // =========================================================
    // 2. –ö–õ–û–ù–£–í–ê–ù–ù–Ø –ó–ê–ì–û–õ–û–í–ö–ê –î–õ–Ø –§–Ü–õ–¨–¢–†–Ü–í
    // =========================================================
    // –ö–ª–æ–Ω—É—î–º–æ –ø–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ thead —ñ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ —è–∫ –¥—Ä—É–≥–∏–π —Ä—è–¥–æ–∫ thead
    var filterRow = $('#tList thead tr:eq(0)').clone(true).addClass('filters');
    filterRow.appendTo('#tList thead');

    // =========================================================
    // 3. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –Ü–ù–ü–£–¢–Ü–í –§–Ü–õ–¨–¢–†–ê–¶–Ü–á
    // =========================================================
    table.columns().eq(0).each(function (colIdx) {

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª—é—á–∏—Ç–∏ —Ü—é –∫–æ–ª–æ–Ω–∫—É
        if (columnsToExclude.includes(colIdx)) {
            // –ó–∞–ª–∏—à–∞—î–º–æ –∫–æ–º—ñ—Ä–∫—É –ø–æ—Ä–æ–∂–Ω—å–æ—é
            $('.filters th').eq(colIdx).html('');
            return; // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó
        }

        // –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–º—ñ—Ä–∫—É –≤ –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–æ–º—É —Ä—è–¥–∫—É —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        var cell = $('.filters th').eq(colIdx);
        var title = $(cell).text();

        // –í—Å—Ç–∞–≤–ª—è—î–º–æ input –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
        $(cell).html('<input type="text" class="form-control form-control-sm" placeholder="–§—ñ–ª—å—Ç—Ä ' + title + '" />');

        // –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ—ó –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        $('input', cell).off('keyup change').on('keyup change', function (e) {
            e.stopPropagation();

            var searchValue = this.value;
            var cursorPosition = this.selectionStart;

            // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ñ—ñ–ª—å—Ç—Ä –¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó –∫–æ–ª–æ–Ω–∫–∏
            table.column(colIdx).search(searchValue).draw();

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –∫—É—Ä—Å–æ—Ä—É
            $(this).focus()[0].setSelectionRange(cursorPosition, cursorPosition);
        });
    });
});
</script>
    


{% endblock %}



