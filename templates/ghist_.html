{% extends "base_tmp.html" %}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">{{ records }}{{ serch_result }}</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      </ul>
      <form class="d-flex gap-1 align-items-center mb-1" method="post">
        <input class="form-control form-control-sm" style="width: 250px;" type="search" placeholder="–ù–∞–∑–≤–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—É"  minlength="5" name = "tov_name" value="{{ tov_name }}">
        <strong> –ê–ë–û </strong>
        <input class="form-control form-control-sm" style="width: 250px;" type="search" placeholder="–°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä"   minlength="5" name = "tov_serial" value="{{ search_value }}">
        <button class="btn btn-primary btn-sm bi-search" type="submit" > –®—É–∫–∞—Ç–∏</button>
        <button type="button" class="btn btn-sm btn-primary" onclick="copyTable()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é</button>
      </form>
    </div>
  </div>
</nav>


<table id="tList" class="table table-sm table-striped table-bordered">
    <thead class="table-dark">
    <tr>
      <th>TOVAR_ID</th>
      <th>–°–µ—Ä—ñ–π–Ω–∏–π –ù–æ–º–µ—Ä</th>
      <th>–ö–æ–¥ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∏</th>
      <th>–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–î—ñ—ó</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOVAR_ID }}</td>
      <td class="fw-bold text-success" style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOVAR_SER_NUM }}</td>
      <td style="padding-top: 1px; padding-bottom: 1px;">{{ row.KOD }}</td>
      <td class="fw-bold text-primary" style="padding-top: 1px; padding-bottom: 1px;">{{ row.TOV_NAME }}</td>
      <td style="padding-top: 1px; padding-bottom: 1px;">
  {% set status_text = row.STATUS_CODE %}
    {% if status_text == 8 %}
        <form target="_blank" method="POST" action="{{ url_for('losses_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-danger text-white fs-6 px-2 py-2 shadow border-0">
                {{ row.STATUS }} >>
            </button>
        </form>
    {% elif status_text == 9 %}
        <form target="_blank" method="POST" action="{{ url_for('dispack_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-secondary text-white fs-6 px-2 py-2 shadow border-0">
                {{ row.STATUS }} >>
            </button>
        </form>
    {% elif status_text == 10 %}
        <form target="_blank" method="POST" action="{{ url_for('dispack_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill bg-warning text-dark fs-6 px-2 py-2 shadow border-0">
                {{ row.STATUS }} >>
            </button>
        </form>

    {% elif status_text == 5 %}
        <form target="_blank" method="POST" action="{{ url_for('dispack_list') }}" style="display:inline;">
            <input type="hidden" name="tov_serial" value="{{ row.TOVAR_SER_NUM }}">
            <button type="submit"
                    class="badge rounded-pill btn-info text-dark fs-6 px-2 py-2 shadow border-0">
                {{ row.STATUS }} >>
            </button>
        </form>
    {% else %}
        <span class="badge rounded-pill bg-success text-light fs-6 px-2 py-2 shadow">
            {{ row.STATUS }}
        </span>
    {% endif %}
</td>
      <td style="padding-top: 1px; padding-bottom: 1px;"><a href="{{ url_for('ghist_details', row_id=row.SERIAL_ID) }}"
                                                            class="btn btn-sm btn-light">–î–µ—Ç–∞–ª—ñ</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<script>
   $(document).ready(function() {
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è DataTables
    $('#tList').DataTable({
        // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Bootstrap 
        // (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–µ—Ä—Å—ñ—ó DataTables, –¥–µ—è–∫—ñ –≤–µ—Ä—Å—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–Ω—Ç–µ–≥—Ä—É—é—Ç—å—Å—è)
        "responsive": true
    });

    // 1. –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ <tfoot> (—Ñ—É—Ç–µ—Ä) —É –≤–∞—à—ñ–π —Ç–∞–±–ª–∏—Ü—ñ.
    // –¶–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –ø—ñ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.
    $('#tList thead tr')
        .clone(true) // –ö–ª–æ–Ω—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        .addClass('filters')
        .appendTo('#tList thead'); // –î–æ–¥–∞—î–º–æ –π–æ–≥–æ —è–∫ –¥—Ä—É–≥–∏–π —Ä—è–¥–æ–∫ –≤ thead

    // 2. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è
    var table = $('#tList').DataTable();

    table.columns().eq(0).each(function (colIdx) {
        // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è (–∫—Ä—ñ–º, –º–æ–∂–ª–∏–≤–æ, –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑ –∫–Ω–æ–ø–∫–∞–º–∏)
        var cell = $('.filters th').eq(
            $(table.column(colIdx).header()).index()
        );
        var title = $(cell).text();
        
        // –í—Å—Ç–∞–≤–ª—è—î–º–æ input –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
        $(cell).html('<input type="text" placeholder="–§—ñ–ª—å—Ç—Ä ' + title + '" />');
        
        // –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ—ó –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        $('input', cell).off('keyup change').on('keyup change', function (e) {
            e.stopPropagation();
            
            // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ñ—ñ–ª—å—Ç—Ä
            $(this).attr('title', $(this).val());
            var regexr = '({search})';
            
            var cursorPosition = this.selectionStart;
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ—Ç–æ—á–Ω–æ—é –∫–æ–ª–æ–Ω–∫–æ—é
            table.column(colIdx).search(
                this.value != '' ? regexr.replace('{search}', this.value) : '',
                this.value != '',
                this.value == ''
            ).draw();

            $(this).focus()[0].setSelectionRange(cursorPosition, cursorPosition);
        });
    });
}); 
    
</script>
    


{% endblock %}



